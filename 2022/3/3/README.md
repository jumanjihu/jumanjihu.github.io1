
# sso原理

## 单系统登录机制
### cookie-session机制
web单系统登录主要通过cookie-session机制，客户端登录后，服务端创建会话id , set到cookie中，并返回给web浏览器，后续浏览器带着会话id请求即代表处于这个登录会话中，不需要再次登录.

## 多系统登录机制
多系统登录借助单系统能力，在单系统不做改造的情况下是这样
访问系统A（a.com）--登录系统A成功--设置a.com 域名cookie. 后续访问系统A不用登录
访问系统B(b.com)-- 登录系统B成功--设置b.com 域名cookie. 后续访问系统B不用登录

## 多系统自动sso登录机制
对比多系统登录机制，我们需要增加一层职责服务统一管理登录状态，并且由于涉及多个域名的自动跳转，需要借助http 302状态码能力。
那么系统链路演化为
访问系统A（a.com）--302--登录sso成功--设置sso.com 域名登录cookie. (后续访问系统A不用登录)
访问系统B(b.com) --302--sso cookie访问sso成功

## 多系统自动sso登录自动跳转访问页面
上述链路缺少登录状态后自动访问要访问地址页面的能力，继续借助302能力实现
访问系统A（a.com）--302--登录sso成功--设置sso.com 域名登录cookie --302--要访问的系统A地址 (后续访问系统A不用登录)
访问系统B(b.com) --302--sso cookie访问sso成功--302--要访问的系统B地址

这里有一个问题：系统A B跳转sso需要知道sso的地址，那么直接在系统A和B配置sso地址即可。但是sso登录或者鉴权已登录之后 继续跳转的url，sso服务怎么区分知道是系统A的url还是系统B的url呢，这时就需要把要访问的url信息带到链路信息上，利用http协议，我们可以放到url上包含系统A和B的原始访问地址，类似sso.com?a.com 或者sso.com?b.com 这种。至此链路可以细化为


访问系统A（a.com）--302 sso.com?a.com--登录sso成功--设置sso.com 域名登录cookie --302--解析url参数要访问的系统A地址 (后续访问系统A不用登录)
访问系统B(b.com) --302--sso.com?b.com-- cookie访问sso成功--302--解析url访问的系统B地址


